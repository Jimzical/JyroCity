<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Include Bootstrap CSS -->
        <link rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <title>Phone</title>
    </head>
    <body>
        <div class="container">
            <!-- Use Bootstrap button classes -->
            <div class="d-flex justify-content-center align-items-center"
                style="height: 100vh;">
                <button id="phoneButton" class="btn btn-primary btn-lg mt-5">Press
                    me</button>
            </div>
            <div class="container">
                <h1 class="text-center mt-5">Values</h1>
                <div class="container">
                    <table id="gameStatus"
                        class="table table-striped table-bordered text-center mt-3">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Alpha</th>
                                <th scope="col">Beta</th>
                                <th scope="col">Gamma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="alpha">0</td>
                                <td id="beta">0</td>
                                <td id="gamma">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
    

        <script>
            window.onload = function() {
                fetch('/domain')
                    .then(response => response.text())
                    .then(domain => {
                        console.log(domain); // Log the domain

                        const ws = new WebSocket(`wss://${domain}`);
                        const phoneButton = document.getElementById('phoneButton');
                        const alphaElement = document.getElementById('alpha');
                        const betaElement = document.getElementById('beta');
                        const gammaElement = document.getElementById('gamma');
                        
                        ws.onopen = () => {
                            console.log('WebSocket connection established in phone page');
                        };

                        ws.onmessage = (event) => {
                            console.log(`Received message from server: ${event.data}`);
                        };

                        let buttonPressed = false;
                        let orientationData = { alpha: 0, beta: 0, gamma: 0 };

                        if (window.DeviceOrientationEvent) {
                            window.addEventListener('deviceorientation', function(event) {
                                orientationData = {
                                    alpha: event.alpha,
                                    beta: event.beta,
                                    gamma: event.gamma
                                };
                                alphaElement.textContent = event.alpha.toFixed(1);
                                betaElement.textContent = event.beta.toFixed(1);
                                gammaElement.textContent = event.gamma.toFixed(1);
                            });
                        }

                        phoneButton.addEventListener('click', () => {
                            buttonPressed = !buttonPressed;
                            phoneButton.style.backgroundColor = buttonPressed ? '#16f716' : 'red';
                            phoneButton.textContent = buttonPressed ? 'Game Started' : 'Game Paused';
                            ws.send(JSON.stringify({ buttonPressed, orientationData }));

                            if (buttonPressed) {
                                intervalId = setInterval(() => {
                                    ws.send(JSON.stringify({ buttonPressed, orientationData }));
                                    // console.log(orientationData.alpha, orientationData.beta, orientationData.gamma);
                                }, 1);
                            } else {
                                clearInterval(intervalId);
                                intervalId = null;
                            }
                        });
                    });
            };
    </script>

        <!-- Include Bootstrap JS and its dependencies -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    </body>
</html>